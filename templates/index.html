<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Agent Based Traffic Simulation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/sim.css') }}"
    />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üöó Agent Based Traffic Simulation</h1>
        <p class="subtitle">Resize, zoom, and pan</p>
      </header>

      <div class="controls">
        <div class="row">
          <div class="upper-wrap">
            <div class="settings">
              <button id="toggleSettingsBtn">‚öôÔ∏è Settings</button>
              <div id="settingsPanel" class="settings-panel active">
                <label for="dtInput">Time Step (dt in ms):</label>
                <input
                  type="number"
                  id="dtInput"
                  value="40"
                  min="5"
                  max="200"
                />

                <!-- Vehicle Mix Ratios: one line left to right, summary underneath -->
                <div class="split-group">
                  <h4>Driver Behavior Mix:</h4>
                  <hr />
                  <div class="behavior-grid">
                    <div class="behavior-col">
                      <div class="behavior-label">Aggressive (%)</div>
                      <input
                        type="number"
                        id="aggressiveInput"
                        value="30"
                        min="0"
                        max="100"
                        class="behavior-input"
                      />
                    </div>

                    <div class="behavior-col">
                      <div class="behavior-label">Defensive (%)</div>
                      <input
                        type="number"
                        id="defensiveInput"
                        value="70"
                        min="0"
                        max="100"
                        class="behavior-input"
                      />
                    </div>
                  </div>

                  <input
                    type="range"
                    id="driverMix"
                    min="0"
                    max="100"
                    value="30"
                    class="behavior-slider"
                  />

                  <div id="driverMixValue" class="behavior-summary">
                    30% Aggressive / 70% Defensive
                  </div>
                  <h4>Vehicle Mix Ratios:</h4>
                  <hr />
                  <div class="vehicle-ratios-row">
                    <label for="truckRatio" class="vehicle-ratio-item">
                      <span class="vehicle-ratio-label">Truck</span>
                      <input
                        type="number"
                        id="truckRatio"
                        class="vehicle-ratio-input"
                        value="4"
                        min="0"
                        step="1"
                      />
                    </label>

                    <label for="suvRatio" class="vehicle-ratio-item">
                      <span class="vehicle-ratio-label">SUV</span>
                      <input
                        type="number"
                        id="suvRatio"
                        class="vehicle-ratio-input"
                        value="2"
                        min="0"
                        step="1"
                      />
                    </label>

                    <label for="motorcycleRatio" class="vehicle-ratio-item">
                      <span class="vehicle-ratio-label">Motorcycle</span>
                      <input
                        type="number"
                        id="motorcycleRatio"
                        class="vehicle-ratio-input"
                        value="1"
                        min="0"
                        step="1"
                      />
                    </label>
                  </div>

                  <div id="vehicleRatioSummary" class="vehicle-ratio-summary">
                    <div id="vehicleRatioRaw">
                      Truck 4 : SUV 2 : Motorcycle 1
                    </div>
                    <div id="vehicleRatioPercent">(57% / 29% / 14%)</div>
                  </div>
                </div>
                <h4>Agent Generation Settings:</h4>
                <hr />
                <label for="agentRate" style="margin-top: 14px"
                  >Goal Spawn Rate (agents/sec):</label
                >
                <input
                  type="number"
                  id="agentRate"
                  value="2.5"
                  min="0"
                  max="6.0"
                />

                <label for="numAgents">Initial Agents:</label>
                <input type="number" id="numAgents" value="0" min="0" />
                <h4>Highway Settings:</h4>
                <hr />
                <label for="highwayLength">Highway Length (m):</label>
                <input
                  type="number"
                  id="highwayLength"
                  value="200"
                  min="200"
                  max="20000"
                />

                <label for="laneNumber">Number of Lanes </label>
                <input
                  type="number"
                  id="laneNumber"
                  value="3"
                  min="1"
                  max="5"
                />

                <label for="laneSize">Size of Lane (m) </label>
                <input
                  type="number"
                  id="laneSize"
                  value="3.657"
                  min="3.0"
                  max="7.0"
                  step="0.01"
                />
                <h4>Logging Settings:</h4>
                <hr />
                <label for="isLogging">Logging agent values? </label>
                <input type="checkbox" id="isLogging" unchecked />

                <label for="logDt">Logging dt (ms) </label>
                <input
                  type="number"
                  id="logDt"
                  value="40"
                  min="10"
                  max="5000"
                  step="10"
                />

                <button
                  id="applySettingsBtn"
                  onclick="initSimulation('traffic')"
                >
                  Apply Settings
                </button>
              </div>
            </div>
            <button
              class="btn-traffic"
              id="initBtn"
              onclick="initSimulation('traffic')"
            >
              Initialize Traffic
            </button>
            <button
              class="btn-start"
              id="startBtn"
              onclick="startSimulation()"
              disabled
            >
              Start
            </button>
            <button
              class="btn-stop"
              id="stopBtn"
              onclick="stopSimulation()"
              disabled
            >
              Stop
            </button>
            <button class="btn-reset" onclick="resetSimulation()">Reset</button>
          </div>

          <div class="zoom-wrap">
            <button id="zoomOutBtn" title="Zoom Out">‚àí</button>
            <input
              id="zoomSlider"
              type="range"
              min="0.25"
              max="25"
              step="0.05"
              value="1"
            />
            <button id="zoomInBtn" title="Zoom In">+</button>
            <span id="zoomLabel">100%</span>
            <button id="resetViewBtn" title="Reset view">Reset View</button>
          </div>
        </div>
      </div>

      <div class="status" id="status">
        No simulation loaded. Click a button above to initialize.
      </div>

      <div class="canvas-shell">
        <div class="viewport" id="viewport">
          <canvas id="simulationCanvas"></canvas>
        </div>
      </div>

      <div class="lower-controls">
        <div class="row" style="font-size: 13px; color: #666">
          Tips: drag to pan. Scroll to zoom at cursor. Keys:
          <span class="kbd">+</span>, <span class="kbd">‚àí</span>,
          <span class="kbd">0</span>.
        </div>
      </div>

      <div class="info">
        Step: <span id="stepCount">0</span> | Agents:
        <span id="agentCount">0</span> | Data: <span id="aggregateData">0</span>
        |
      </div>
      <div class="legend" style="margin-top: 8px; font-size: 13px">
        <strong>Color Legend:</strong>
        <ul style="list-style: none; padding: 0; margin: 4px 0">
          <li>
            <span
              style="
                display: inline-block;
                width: 12px;
                height: 12px;
                background-color: #f77926;
                border-radius: 2px;
                margin-right: 6px;
              "
            ></span
            >Brake
          </li>
          <li>
            <span
              style="
                display: inline-block;
                width: 12px;
                height: 12px;
                background-color: #22c55e;
                border-radius: 2px;
                margin-right: 6px;
              "
            ></span
            >Accelerate
          </li>
          <li>
            <span
              style="
                display: inline-block;
                width: 12px;
                height: 12px;
                background-color: #eab308;
                border-radius: 2px;
                margin-right: 6px;
              "
            ></span
            >Cruise
          </li>
        </ul>
      </div>
    </div>
    <script src="{{ url_for('static', filename='js/sim.js') }}"></script>
  </body>
</html>
